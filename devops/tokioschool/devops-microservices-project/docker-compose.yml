version: '3.8'

services:
  service-a:
    build: ./microservices/service-a
    container_name: service-a
    ports:
      - "8001:8001"
    environment:
      - SERVICE_B_URL=http://service-b:8002
      - JAEGER_AGENT_HOST=jaeger
      - PORT=8001
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8001/health"]
      interval: 10s
      timeout: 5s
      retries: 5
    depends_on:
      - jaeger
    networks:
      - devops-net

  service-b:
    build: ./microservices/service-b
    container_name: service-b
    ports:
      - "8002:8002"
    environment:
      - JAEGER_AGENT_HOST=jaeger
      - PORT=8002
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8002/health"]
      interval: 10s
      timeout: 5s
      retries: 5
    depends_on:
      - jaeger
    networks:
      - devops-net

  jaeger:
    image: jaegertracing/all-in-one:1.51
    container_name: jaeger
    ports:
      - "16686:16686" # UI
      - "6831:6831/udp" # Agent
    networks:
      - devops-net

networks:
  devops-net:
    driver: bridge